#!/bin/sh

ENTRIES="HomeAssistant
Calendar
Laundry Booking
Poll Kung DotA
mpv view (link from clipboard)
Twitch
PiCamera"

LINES=$(echo "$ENTRIES" | wc -l)

SELECTED=$(echo "$ENTRIES" \
  | rofi -dmenu -i -l "$LINES" -p "What to launch?" \
  | cut -d' ' -f1 \
  | awk '{print tolower($1)}')

case "$SELECTED" in
  homeassistant)
    URL=http://192.168.1.10:8123;;
  calendar)
    URL=https://calendar.google.com;;
  laundry)
    URL="https://sssb.aptustotal.se/AptusPortal/Account/Login";;
  poll)
    URL=$(curl -s https://api.bollsvenskan.jacobadlers.com/dota/signup | jq -r ".currentPollUrl");;
  picamera)
    i3-msg "exec mpv --profile=low-latency --untimed av://v4l2:/dev/video0";
    exit 0;;
  mpv)
    URL=$(xclip -o)
    case $URL in
      https://www.twitch.tv* \
        | https://www.youtube.com* \
        | https://www.svtplay.se/video/*)
        notify-send "Stream with mpv (streamlink)" "$URL";
        i3-msg "exec streamlink --title '{title}' $URL best";;
      *)
        notify-send "Stream with mpv" "$URL";
        i3-msg "exec mpv -x11-name=mpvfloat $URL";;
    esac
    exit 0;;
  twitch)
    stream=$(rofi -dmenu -l 1)
    if [ -z "$stream" ]; then
      exit 1
    fi
    URL="https://www.twitch.tv/$stream"
    notify-send "Watch twitch" "Streamer: $stream"
    i3-msg "exec streamlink --title '{title}' $URL best"
    exit 0;;
  *)
    exit 1;;
esac

i3-msg focus output DisplayPort-2 && i3-msg -- exec surf "$URL"
